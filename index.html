<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Server Data to Voice</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="container">
    <h1>Server Data to Voice Output</h1>
    <button id="fetchDataBtn">Fetch Data from Server</button>
    <p id="serverData">No data received...</p>
    
    <h2>Voice Output</h2>
    <button id="speakBtn" disabled>Speak Data</button>
    <button id="stopSpeakBtn" disabled>Stop</button>

    <label for="voiceSelect">Choose Voice:</label>
    <select id="voiceSelect"></select>

    <label for="rateSelect">Speed:</label>
    <select id="rateSelect">
      <option value="0.7">Slow</option>
      <option value="1" selected>Normal</option>
      <option value="1.3">Fast</option>
    </select>
  </div>

  <script>
    // DOM Elements
    const fetchDataBtn = document.getElementById('fetchDataBtn');
    const serverData = document.getElementById('serverData');
    const speakBtn = document.getElementById('speakBtn');
    const stopSpeakBtn = document.getElementById('stopSpeakBtn');
    const voiceSelect = document.getElementById('voiceSelect');
    const rateSelect = document.getElementById('rateSelect');

    // Speech Synthesis
    const synth = window.speechSynthesis;
    let voices = [];
    let currentUtterance = null;

    // Load available voices
    function loadVoices() {
      voices = synth.getVoices();
      voiceSelect.innerHTML = '<option value="">Default Voice</option>';

      voices.forEach(voice => {
        const option = document.createElement('option');
        option.value = voice.name;
        option.textContent = `${voice.name} (${voice.lang})`;
        voiceSelect.appendChild(option);
      });
    }

    synth.onvoiceschanged = loadVoices;
    loadVoices();

    // Fetch data from the server
    async function fetchData() {
      try {
        const response = await fetch('https://server-webk.onrender.com');
        const result = await response.json();
        serverData.textContent = result.data || 'No data available';
        speakBtn.disabled = false;
      } catch (error) {
        console.error('Error fetching data:', error);
        serverData.textContent = 'Failed to fetch data.';
      }
    }

    // Speak data using Speech Synthesis
    function speakData() {
      if (synth.speaking) synth.cancel();

      currentUtterance = new SpeechSynthesisUtterance(serverData.textContent);

      const selectedVoiceName = voiceSelect.value;
      if (selectedVoiceName) {
        const selectedVoice = voices.find(voice => voice.name === selectedVoiceName);
        if (selectedVoice) currentUtterance.voice = selectedVoice;
      }

      currentUtterance.rate = parseFloat(rateSelect.value);
      synth.speak(currentUtterance);
    }

    // Stop speech
    function stopSpeaking() {
      if (synth.speaking) synth.cancel();
    }

    // Event Listeners
    fetchDataBtn.addEventListener('click', fetchData);
    speakBtn.addEventListener('click', speakData);
    stopSpeakBtn.addEventListener('click', stopSpeaking);

  </script>
</body>
</html>
